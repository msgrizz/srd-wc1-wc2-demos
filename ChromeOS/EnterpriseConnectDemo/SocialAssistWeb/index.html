<!DOCTYPE html>

<html>
<head>
    <title>Social Assist</title>
     <link rel="stylesheet" href="css/main.css">
    <script src="js/vendor/jquery-1.10.2.min.js"></script>
    <script src="js/vendor/peer.js"></script>
    <script src="js/app.js"></script>
    <script src='https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false'></script>
    <script>
	// Compatibility shim
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
        var peer = null;
        var readyForCall = false;
        var ringing = false;
        var ringtone = new Audio('/media/ringtone.ogg');
        ringtone.addEventListener('ended', function() {this.currentTime = 0;if(ringing){this.play();}}); //loop for the ringtone

        
        var messageHandler = function(e) {
            console.log('Message Received', e.data);
            
            var message = e.data;
            
            if (message.name == 'gps') {
                initializeStreetView(message);
            }
            
            
            
        };

        window.addEventListener('message', messageHandler);
        
        var panorama;
	
	function init(){
	    setButtonState(false);
            readyForCall = false;
	    
	    $('#butCall').attr("disabled", true);
	    $('#butConnect').attr("disabled", true);
	    $('#butCall').click(makeCall);
	    $('#txtCallerId').keyup(function() {
		  if($(this).val() != '') {
		     $('#butCall').attr("disabled", false);
		  }
		  else{
		    $('#butCall').attr("disabled", true);
		  }
	       });
	    $('#txtUserHandle').keyup(function() {
		  var server = $('#txtServer').val();
		  var port = $('#txtPort').val();
		  if($(this).val() != '' && server != '' && port != '') {
		     $('#butConnect').attr("disabled", false);
		  }
		  else{
		    $('#butConnect').attr("disabled", true);
		  }
	       });
	    
	     $('#txtServer').keyup(function() {
		  var userHandle = $('#txtUserHandle').val();
		  var port = $('#txtPort').val();
		  if($(this).val() != '' && userHandle != '' && port != '') {
		     $('#butConnect').attr("disabled", false);
		  }
		  else{
		    $('#butConnect').attr("disabled", true);
		  }
	       });
	     
	      $('#txtPort').keyup(function() {
		  var server =  $('#txtServer').val();
		  var userHandle = $('#txtUserHandle').val();
		  if($(this).val() != '' && server != '' && userHandle != '') {
		     $('#butConnect').attr("disabled", false);
		  }
		  else{
		    $('#butConnect').attr("disabled", true);
		  }
	       });
	    
	}
        
        function initializeStreetView() {
            var view = new google.maps.LatLng(47.650953,-122.347323);
            var panoramaOptions = {
              position: view,
              pov: {
                heading: 0,
                pitch: 0,
              }
            };
            panorama = new  google.maps.StreetViewPanorama(document.getElementById('pano'),panoramaOptions);
          
        }
        
        
        function updateStreetView(heading, pitch){
            console.log('updating street view to heading: ' + heading + ' with pitch ' + pitch);
            if (!panorama) {
                console.log('no streetview object to update - returning');
                return;
            }
            panorama.setPov({
			    heading: heading,
			    pitch:pitch});
            
        } 
        
       window.addEventListener('load', init);
    </script>
</head>

<body>
     <div class="applicationContainer">
     <div id="video-container">
            <video id="remote-video" autoplay></video>
            <video id="local-video" muted="true" autoplay></video>
    </div>
    <div id="incoming-call">
            <img src="img/incoming.png"/>
            <h3></h3>
            <input type="button" id="butAnswerCall" value="Answer"/>
    </div>
    
     <div id="controlPanel">
            <div id="logHolder"></div>
            <div id="options">
           
            <span>
              <fieldset>
                    <legend>WebRTC Connection Info:</legend>
                    <input type="checkbox" name="chkPLTDevice" checked="checked" id="chkPLTDevice" />
                    <label for="chkPLTDevice">Connect to device</label><br>
                    <span>Server:
                    <input name="txtServer" id="txtServer" type="text" value="10.0.1.51" max="15" maxlength="25" />
                    <br>
                    </span>
                    <span>Port:
                    <input name="txtPort" id="txtPort" type="text" value="9000" max="15" maxlength="25" />
                    <br>
                    </span>
                    <span>Name:
                    <input name="txtUserHandle" id="txtUserHandle" type="text" max="15" maxlength="25" />
                    <br>
                    </span>
                    <input type="button" id="butConnect" value="Connect"/>  
              </fieldset>
              <fieldset>
                    <legend>Call Someone:</legend>
                    <span>
                    <label for="txtCallerId">User name:</label>
                    <input name="txtCallerId" id="txtCallerId" type="text" max="15" maxlength="25" />
                    </span>
                    <input type="button" id="butCall" value="Call"/>
              </fieldset>      
            </div>
        </div>  
    <div id="pano" style="top: 8px; width: 600px; height: 400px;"></div>
     </div>
</body>
</html>
