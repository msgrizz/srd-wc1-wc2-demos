<!DOCTYPE html>

<html>
<head>
    <title>Social Assist</title>
    <link rel="stylesheet" href="css/main.css">
    <script src="js/vendor/jquery-1.10.2.min.js"></script>
    <script src="js/vendor/peer.js"></script>
    <script src="js/app.js"></script>
    <script src='https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false'></script>
    <script>
	var handleId = "Joe";
	var calleeId = "Cary";
	var port = "9000";

	// Compatibility shim
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
        var peer = null;
        var readyForCall = false;
        var ringing = false;
        var ringtone = new Audio('/media/ringtone.ogg');
        ringtone.addEventListener('ended', function() {this.currentTime = 0;if(ringing){this.play();}}); //loop for the ringtone

        var panorama;
	var map;
	
	function init(){
	    readyForCall = false;
	    $('#btnCall').attr("disabled", true);
	    $('#btnCall').click(makeCall);
	    $('#btnHangUp').attr("disabled", true);
	    $('#btnHangUp').click(hangUp);
	    $('#btnHangUp').hide();
	    $("input[name='server']").click(function(){
		connectToServer(this.value);
		this.disabled = true;
		});
	    $('#btnCall').click(makeCall);
	    $('#pano').hide();
	    $('#map-canvas').hide();
	    
	}
        
        function initializeStreetView(gps) {
	    $('#content-filler').hide();
	    $('#pano').show();
	    $('#map-canvas').show();
            
	    var view = new google.maps.LatLng(gps.lat, gps.long);
	    var mapOptions = {
		"center": view,
		"zoom": 15
	    };
	    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
            var panoramaOptions = {
              position: view,
              pov: {
                heading: 0,
                pitch: 0,
              }
            };
            panorama = new  google.maps.StreetViewPanorama(document.getElementById('pano'),panoramaOptions);
            map.setStreetView(panorama);
	    sendGPSSetMessageToPeer();
        }
        
        
        function updateStreetView(heading, pitch){
            console.log('updating street view to heading: ' + heading + ' with pitch ' + pitch);
            if (!panorama) {
                console.log('no streetview object to update - returning');
                return;
            }
            panorama.setPov({
			    heading: heading,
			    pitch:pitch});
	   
            
        } 
        
       window.addEventListener('load', init);
    </script>
</head>

<body>
    <div id="centerpoint">
	<div id="incoming-call">
	    <img id="call-img" src="img/call.jpg"/>
	    <span id="peer-information"></span>
	    <input type="button" id="butAnswerCall" value="Answer"/>			
	</div>
    </div>
    <div class="applicationContainer">
        <div id="connectBar">
            <span>
            <img src="img/pltlabslogo.jpg" />
            <span class="name">Wearables + WebRTC Concept<br><span class="user-name" id="user-name"></span></span>
            </span>
        </div>
	 <div id="sensorpane">
            <div id="sensortable">
                <table>
                    <thead>
                        <h3>Wanderlust has gotten the better of me...</h3>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
				<div id="content-filler" style="width: 600px; background-size: cover; background-image: url('img/content-filler.png'); height: 400px">
				</div>
				<div id="pano" style="width: 600px; height: 400px;"></div>
			    </td>
                            <td width="300">
				<span>WebRTC Server:</span><br>
				<input type="radio" name="server" id="server" value="10.0.1.51">Intranet
				<input type="radio" name="server" id="server" value="23.23.249.221">EC2<br>
				<div id="video-container">
				   <video id="remote-video" autoplay></video>
				</div>
				<input type="button" id="btnCall" value="Call For Help"/>
                                <input type="button" id="btnHangUp" value="Hang Up"/><br>
				
				<!--<input type="button" id="btnConnect" value="Connect"/>
				<input type="button" id="btnCall" value="Call For Help"/>-->
				<div id="map-canvas" style="width: 300px; height: 200px"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
     </div>
</body>
</html>
